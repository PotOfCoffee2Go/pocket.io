function io(n,e){"object"==typeof n&&(n=(e=n||e).url);var t=(e||{}).JSON||JSON,o=!1,c=[],i={},e=new URL(n||location.href),r=new WebSocket([e.protocol.replace("http","ws"),"//",e.host,"/pocket.io/"].join("")),s=(r.onopen=function(n){for(s.emit("connect"),o=!0;c.length;)r.send(c.shift())},r.onmessage=function(n){var n=t.parse(n.data),e=i[n.type];"connect"===n.type?(s.id=n.data,u(e)):n.data?u(e,n.data):u(e)},r.onerror=function(n){u(i.error,n)},r.onclose=function(n){r=null,u(i.close)},{close:function(){return r&&r.close(),s},emit:function(n,e){n=t.stringify({type:n,data:e});return o?r.send(n):c.push(n),s},listeners:function(n){return i[n]||[]},hasListeners:function(n){return 0<s.listeners(n).length},on:function(n,e){return(i[n]||(i[n]=[])).push(e),s},once:function(n,e){var t=i[n]||(i[n]=[]);return t.push(function n(){t.splice(t.indexOf(n),1),e.apply(this,arguments)}),s},off:function(n,e){n=i[n]||[],e=n.indexOf(e);return-1<e&&n.splice(e,1),s},send:function(n){return s.emit("message",n)}});return s.disconnect=s.close,s;function u(n){(n||[]).forEach(function(n){n.apply(s,this)},[].slice.call(arguments,1))}}